# open函数和with临时运行环境

## **open函数**

**open函数：** file=open\(filename, encoding='utf-8'\)，open\(\)函数是Python内置的用于对文件的读写操作，返回的是文件的流对象（而不是文件本身，所以使用的方法都是流对象的方法）。使用这个函数时可以指定encoding参数（Python2.7中不支持），因为Python代码在不同的平台环境中使用的默认编码方式不同，有可能会发生编译出错的问题。

**filename参数：**在open中的文件名参数filename中，包含的路径表示虽然可以根据不同的环境使用斜杠和反斜杠，但在Python中表路径时，斜杠都是正确的。

**文件操作对象file：**流对象file，即open的默认模式下的返回值。使用for循环对对象file进行迭代时，每次迭代都会自动分离出一行（效果相当于对readlines结果的for循环遍历）：

* **file.name：**获取文件的文件名（包含路径），即传入open文件名参数。
* **file.encoding：**获取文件的编码方式。
* **file.mode：**获取文件的访问方式，若没有指定这个参数，open的默认访问方式为只读“r”，更多访问方式见下表。
* **file.closed：**返回文件是否关闭的状态。
* **file.close\(\)：**关闭文件（使用完一定及时使用这个函数关闭文件并释放系统资源）。
* **file.read\(size/n\)：**从当前定位（一般就是文件开始处）获取文件内容，返回整个文件内容的字符串（此时定位在文件尾，若再使用read\(\)方法，会返回空字符串，因为已经到文件尾了），若指定了需要获取的字符数n（较低版本则是指定字节数size），可以给read方法传入参数，比如：read\(3\)表示从当前定位往后读取3个字符，则返回指定字符数的字符串。注意不能从一个字符的中间字节处读取，因为有的字符（比如中文）的表示不止一个字节，而定位是以字节来计算位置的，read\(\)是以字符来计数的。
* **file.seek\(offset, whence=0\)：**使定位到特定字节处（若使用read\(\)方法读完文件后还想再读取一次文件，可以使用seek\(0\)重新定位到文件开始处再读取），whence取值有0、1和2，0是默认值，表示文件头，1表示当前位置，2表示文件尾，例如file.seek\(3, 1\)表示定位到从当前位置往后三个字节处，file.seek\(-5, 2\)表示定位到从文件尾往前5个字节处。
* **file.tell\(\)：**返回当前定位的字节位置。
* **file.readline\(\)：**读取文件中的一行，并定位到下一行的开始处。
* **file.readlines\(\)：**读取文件中的所有行，返回所有行为元素组成的列表。
* **file.write\(s\)：**将字符串写入到文件中，返回写入的字符数。
* **file.writelines\(lines\)：**将一个字符串列表写入文件，如果需要换行，则需要自己在每个字符串后面加上换行符。

### 更多文件访问方式（此表来源：[http://www.runoob.com/python3/python3-file-methods.html）：](http://www.runoob.com/python3/python3-file-methods.html）：)

| **模式** | **描述** |
| :--- | :--- |
| t | 文本模式 \(默认\)。 |
| x | 写模式，新建一个文件，如果该文件已存在则会报错。 |
| b | 二进制模式。 |
| + | 打开一个文件进行更新\(可读可写\)。 |
| U | 通用换行模式（不推荐）。 |
| r | 以只读方式打开文件。文件的指针将会放在文件的开头（默认模式）。 |
| rb | 以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。 |
| r+ | 打开一个文件用于读写。文件指针将会放在文件的开头。 |
| rb+ | 以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。 |
| w | 打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| wb | 以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |
| w+ | w+    打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| wb+ | 以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |
| a | 打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
| ab | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
| a+ | 打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。 |
| ab+ | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。 |

## with创建临时运行环境

**作用：**with用于创建一个临时的运行环境，运行环境中的代码执行完后自动安全退出环境。

**文件操作：**使用open进行文件操作使建议使用with创建运行环境，可以不用close\(\)方法关闭文件，无论在文件使用中遇到什么问题都能安全的退出，即使发生错误，退出运行时环境时也能安全退出文件并给出报错信息。

```text
# 使用with创建运行时环境
with open('xxx.text', encoding='utf-8') as file:
    file_content = file.read()
    file.seek(0)
    file_ten_characters = file.read(10)
    print(file_content)
    print(file_ten_characters) 
    #执行完with中的代码后自动退出运行时环境
```

